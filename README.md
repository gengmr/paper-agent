# 论文写作智能体 (AI-Powered Academic Writing Assistant)

**论文写作智能体**是一个全流程、智能化的学术研究与论文写作辅助平台。它深度集成了先进的大语言模型（LLM），将繁琐的学术工作流——从文献调研、分析综述到最终成稿——整合为一个连贯、高效、可视化的操作环境。

本项目的核心理念是将复杂的学术研究过程解构为一系列相互关联的模块化任务，并通过强大的后端服务与精心设计的用户界面，引导用户以结构化的方式完成高质量的学术产出。

## ✨ 核心特性

*   **📚 全自动文献分析**:
    *   **单篇深度解析**: 自动提取 PDF 论文的 Markdown 全文，并生成涵盖核心问题、创新点、方法、结论和不足的专业分析报告。
    *   **多篇智能综述**: 一键整合多篇文献分析，撰写全面、深刻的综合性文献综述，自动梳理研究热点、主流方法、学术共识与争议。

*   **💡 创新课题激发**:
    *   **研究空白识别**: 基于宏观综述与微观细节，智能识别研究空白（Gaps），激发具有高度创新性的研究课题。
    *   **人机协同迭代**: 支持对 AI 生成的课题进行多轮对话式修改和优化，实现深度思考。

*   **✍️ 结构化论文写作**:
    *   **可视化大纲**: 提供覆盖从核心想法到结论的完整论文结构，各章节的撰写遵循严谨的学术逻辑依赖。
    *   **上下文感知生成**: AI 在撰写任一章节时，会自动参考所有前置章节内容，确保论文的逻辑连贯性和一致性。
    *   **强大的编辑与润色工具**:
        *   **AI 批注**: 一键调用 AI 像审稿人一样对您的文稿进行批注，提出专业修改意见。
        *   **批注驱动修改**: AI 可自动根据生成的批注，对原文进行精准修改。
        *   **扩写与润色**: 轻松对段落进行内容扩充或语言优化。

*   **🔬 专业的用户体验**:
    *   **差异对比视图 (Diff Viewer)**: 所有 AI 的修改都会在清晰的差异对比窗口中呈现，您可以逐一审查并决定是否接受，确保您对内容的绝对控制。
    *   **数学公式支持**: 完美渲染 LaTeX 数学公式，满足专业写作需求。
    *   **实时网络信息**: 集成 Google Search 作为 grounding 工具，使 AI 的回答能够基于最新的网络信息，更具时效性。
    *   **状态持久化**: 所有工作进度（包括分析报告、写作内容）都会自动保存在本地，可随时中断和恢复。

## 🛠️ 技术栈

*   **后端**:
    *   **Web 框架**: Flask
    *   **AI 模型**: Google Gemini 系列 (通过 `google-genai` SDK)
    *   **核心逻辑**: Python 3.10+
*   **前端**:
    *   **基础**: HTML5, CSS3, JavaScript (ES6+)
    *   **Markdown 渲染**: Marked.js
    *   **数学公式**: MathJax 3
    *   **差异对比**: diff.js
    *   **图标库**: Phosphor Icons
*   **核心理念**:
    *   **架构**: 分层服务架构 (SOA)
    *   **设计**: 提示工程驱动 (Prompt-Centric)

## 🚀 系统架构

本项目的架构遵循**模块化、服务化、状态持久化**和**以提示工程为核心**的设计哲学，旨在构建一个可扩展、易维护且功能强大的智能应用。

### 1. 整体设计哲学

*   **分层服务架构 (Service-Oriented Architecture)**: 项目逻辑被清晰地划分为表现层 (`Flask App`)、服务层 (`services/`) 和数据与配置层 (`papers/`, `result/`, `prompts/`)，实现了高度解耦。
*   **状态持久化 (Stateful Persistence)**: 用户的每一步操作和AI的每一次输出都被持久化地保存在文件系统中。`paper_writing/` 目录下的 JSON 文件是这一思想的集中体现，它完整记录了论文写作的每一个章节的状态和内容。
*   **渐进式工作流 (Progressive Workflow)**: 四大核心功能构成了一个逻辑严谨的学术研究漏斗，从广泛的文献输入，到提炼为综合综述，再聚焦于创新想法，最终收敛至一篇完整的论文。
*   **提示工程为核心 (Prompt-Centric Design)**: 项目的“智能”由 `prompts/prompts.json` 文件中的高质量提示词（Prompts）驱动。我们将提示词视为一种“软代码”，通过修改 JSON 文件即可快速迭代和优化 AI 的行为，而无需改动后端逻辑。

### 2. 项目结构详解

```
.
├── app.py                  # Flask应用主文件，负责路由和业务流程编排
├── config.py               # 全局配置文件（模型列表、论文结构）
├── requirements.txt        # Python依赖项
├── papers/                 # 用户存放待分析的PDF文献
├── prompts/
│   └── prompts.json        # 核心：定义所有与LLM交互的提示词
├── result/                 # 存放所有AI生成的结果
│   ├── analyses/           # 存放单篇文献的深度分析报告
│   ├── brainstorms/        # 存放头脑风暴结果
│   ├── markdowns/          # 存放PDF转换后的Markdown原文
│   ├── paper_writing/      # 存放结构化论文的JSON文件
│   └── reports/            # 存放综合文献综述报告
├── services/               # 核心业务逻辑服务
│   ├── file_service.py     # 封装所有文件系统操作
│   └── llm_service.py      # 封装所有与Google Gemini API的交互
├── static/                 # 前端静态文件 (CSS, JS)
├── templates/              # Flask HTML模板
└── README.md               # 本文件
```

## ⚙️ 安装与启动

### **环境要求**
*   **操作系统**: Windows, macOS, 或 Linux
*   **Conda**: 确保您的系统中已安装 [Anaconda](https://www.anaconda.com/products/distribution) 或 [Miniconda](https://docs.conda.io/en/latest/miniconda.html)。
*   **Git**: 确保您的系统中已安装 [Git](https://git-scm.com/)。
*   **Python**: 3.10 或更高版本。

### **步骤一：克隆项目代码**
打开您的终端，并执行以下命令将项目代码克隆到本地：
```bash
git clone <your-repository-url>
cd <project-directory-name>
```

### **步骤二：创建并激活Conda环境**
我们将创建一个独立的 Conda 环境以确保依赖隔离。
```bash
# 创建一个名为 paper_agent 的新环境，并安装 Python 3.10
conda create -n paper_agent python=3.10 -y

# 激活新创建的环境
conda activate paper_agent
```
成功激活后，您终端的命令提示符前会显示 `(paper_agent)`。

### **步骤三：安装项目依赖**
在已激活的环境中，使用 `pip` 安装所有必需的 Python 库。
```bash
pip install -r requirements.txt
```

### **步骤四：准备待分析的文献**
将您需要分析的 PDF 格式学术论文，复制或移动到项目根目录下的 `papers/` 文件夹中。

### **步骤五：启动Web应用服务**
执行以下命令来启动 Flask Web 服务器：
```bash
python app.py
```
启动成功后，您将在终端看到服务器正在 `http://127.0.0.1:5001` 上运行。

### **步骤六：访问并配置应用**
1.  **访问应用**: 打开您的网页浏览器，在地址栏输入 `http://127.0.0.1:5001` 并回车。
2.  **配置API Key**: 在首页的输入框中粘贴您的 Google API Key，然后点击“保存密钥”。密钥会安全地保存在您浏览器的本地存储中，不会上传至任何服务器。

现在，您可以开始使用论文写作智能体的各项功能了。

## 📖 使用流程详解

本工具遵循“文献输入 -> 提炼洞察 -> 构思创新 -> 结构化成文”的学术研究逻辑。

### **第 1 步：首页与设置**

这是您与智能体的起点。

*   **核心操作**: 在首页输入框中粘贴您的 Google API Key 并点击“保存”。这是一个一次性的设置步骤。
*   **安全提示**: 您的密钥仅存储在您当前浏览器的 `localStorage` 中，这意味着它不会离开您的电脑，保证了安全性。

### **第 2 步：单篇文献分析**

此模块负责将原始 PDF 文献转化为结构化的、可被机器理解的知识。

*   **准备工作**: 将您需要分析的所有 PDF 论文放入项目根目录下的 `papers/` 文件夹。
*   **参数配置**:
    *   **模型选择**: 根据需求选择不同的 Gemini 模型（如 Pro 版质量更高，Flash 版速度更快）。
    *   **Temperature**: 您可以为“原文提取”和“分析报告”设置不同的 `temperature` 值。建议将原文提取的 `temperature` 设为 0 以确保最高保真度，将分析报告的 `temperature` 设为 1 左右以获得更具洞察力的分析。
*   **执行分析**: 点击“开始分析”按钮。系统会自动检测 `papers/` 目录中所有尚未处理的 PDF 文件，并逐一执行以下两项任务：
    1.  **全文提取**: 调用 LLM 将 PDF 内容完整转换为结构化的 Markdown 文本。
    2.  **深度分析**: 基于原文，生成一份包含核心问题、创新点、方法、结论和不足的专业分析报告。
*   **结果与反馈**:
    *   您可以在页面下方的日志窗口中实时查看处理进度。
    *   文件列表中的状态指示器会从“待处理”变为“正在处理”，最终变为“已处理”。
    *   所有生成的文件都保存在 `result/markdowns/` 和 `result/analyses/` 目录中。

### **第 3 步：综合文献分析**

此模块将孤立的单篇文献知识，汇聚成对整个研究领域的宏观洞察。

*   **选择文献**: 页面会自动列出所有已完成单篇分析的文献。您可以手动勾选需要纳入综述的文献，或使用“全选”/“全不选”按钮进行快捷操作。
*   **生成综述**: 点击“生成/更新综述报告”按钮。
*   **工作原理**: 系统会将您选定的所有单篇分析报告整合起来，形成一个富含信息的上下文，然后指令 AI 在此基础上撰写一份全面的文献综述。
*   **产出**: 生成的综述报告会直接显示在页面上，内容涵盖领域背景、研究热点、主流方法、共识与争议，并敏锐地指出**研究空白（Gaps）**。报告同时会保存为 `result/reports/Comprehensive_Report.md`。

### **第 4 步：头脑风暴**

这是从知识输入到创新输出的关键一步，旨在激发新的研究灵感。

*   **初次生成**: 点击“开始头脑风暴”。AI 会同时利用“综合分析报告”的宏观视角和所有“单篇分析”的微观细节，提出多个具有高价值的创新研究课题。
*   **迭代优化**: 这是本模块的核心。当结果生成后，页面底部会出现一个修改指令输入框。您可以像对话一样，用自然语言提出修改要求，例如：
    *   “将第二个课题的研究方法具体化到深度学习领域。”
    *   “合并第一和第三个课题，提出一个更具综合性的研究方向。”
    *   “为所有课题增加一个‘预期挑战’部分。”
    点击“提交修改”，AI 将根据您的指令对现有结果进行优化。
*   **版本控制**: 您可以使用“回退”和“前进”按钮，在不同版本的头脑风暴结果之间轻松切换。

### **第 5 步：论文写作**

这是一个功能强大的结构化写作环境，引导您从零开始完成一篇完整的论文。

*   **文档管理**:
    *   在页面顶部的管理卡片中，您可以**新建**一篇论文、通过下拉菜单**切换**不同的论文项目、**重命名**或**删除**当前论文。
    *   所有写作进度都会被**自动保存**，无需手动操作。
*   **结构化写作流程**:
    *   写作界面遵循标准的论文结构（核心想法、标题、摘要、引言等）。
    *   **依赖解锁**: 章节之间存在逻辑依赖关系。例如，只有在完成“结果”部分后，“讨论”部分才会解锁。这确保了写作的逻辑性和连贯性。
*   **AI 与手动协同写作工具**:
    *   **生成 (Generate)**: 对于任何已解锁的空白章节，点击“生成”按钮，AI 会自动参考所有前置章节的内容，为您撰写该部分的初稿。
    *   **编辑与手动批注 (Edit & Manual Annotation)**: 点击“编辑”进入手动编辑模式。在此模式下，您不仅可以自由修改内容，还可以进行**手动批注**。只需选中文本，点击旁边出现的浮动工具栏上的批注图标，即可为您选中的文本添加 `{{...}}【修改意见：...】` 格式的批注。这对于记录自己的修改思路或与 AI 协同工作非常有用。
    *   **修改 (Modify)**: 点击后，可在底部输入框中给出具体的修改指令，AI 将重写当前章节。
    *   **AI 批注 (AI Annotate)**: 一键让 AI 扮演学术审稿人的角色，对当前章节内容进行逐句批注，同样使用 `{{原文}}【修改意见】` 的格式高亮显示。
    *   **批注修改 (Modify Annotated)**: 无论是 AI 自动生成的批注，还是您手动添加的批注，点击此按钮后，AI 都会自动采纳所有批注建议，生成一份干净、优化后的新版本。
    *   **扩写 (Expand) / 润色 (Polish)**: 对选定章节进行一键式的内容丰富或语言优化。
*   **差异对比与确认 (Diff Viewer)**:
    *   **至关重要的一步**: 任何由 AI 执行的修改操作（如修改、批注修改、扩写、润色），**都不会**直接覆盖您的原文。
    *   系统会弹出一个**差异对比窗口**，并排展示修改前和修改后的版本，所有增删都清晰可见。
    *   您拥有最终决定权：可以选择**“接受新版本”**来采纳 AI 的修改，或**“放弃更改”**来保留原文。这确保了您对论文内容的绝对控制权。