{% extends "layout.html" %}
{% block title %}论文写作{% endblock %}
{% block content %}
<!-- 专注模式切换按钮，独立于其他控件，固定在右上角 -->
<button id="toggle-focus-mode-btn" class="btn btn-focus-mode" title="专注模式">
    <i class="ph ph-corners-out"></i>
</button>

<!-- 字数统计显示区域，将被CSS固定在右下角 -->
<div id="word-count-display" class="word-count-display"></div>

<div class="page-header">
    <h1>论文写作</h1>
    <p>在此页面中，您可以创建、管理并逐步完成多篇论文的撰写。</p>
</div>

<!-- 文章管理中心 -->
<div class="controls-card" id="paper-management-card">
    <!-- Left Column: Document Management & Tools -->
    <div class="card-section">
        <h3 class="section-title"><i class="ph ph-folder-open"></i> 文章管理与工具</h3>
        <div class="control-group">
            <label for="paper-select">当前文章:</label>
            <div class="input-with-button">
                <select id="paper-select"><!-- Options populated by JS --></select>
                <button id="new-paper-btn" class="btn" title="新建文章"><i class="ph ph-plus"></i></button>
            </div>
        </div>
        <div class="control-group">
            <label for="rename-input">重命名:</label>
            <div class="input-with-button">
                <input type="text" id="rename-input" placeholder="输入新名称...">
                <button id="rename-paper-btn" class="btn" title="确认重命名"><i class="ph ph-check"></i></button>
                <button id="delete-paper-btn" class="btn" title="删除当前文章"><i class="ph ph-trash"></i></button>
            </div>
        </div>
        <div class="control-group">
             <label>导出:</label>
             <div class="export-buttons">
                <button id="export-pdf-btn" class="btn"><i class="ph ph-file-pdf"></i> 导出为 PDF</button>
                <button id="export-markdown-btn" class="btn"><i class="ph ph-file-md"></i> 导出 Markdown</button>
            </div>
        </div>
    </div>

    <!-- Right Column: AI Settings -->
    <div class="card-section">
        <h3 class="section-title"><i class="ph ph-gear-six"></i> AI 全局设置</h3>
         <div class="control-group">
            <label for="paper-model-select">模型:</label>
            <select id="paper-model-select">
                {% for model in models %}<option value="{{ model }}">{{ model }}{% if loop.first %} (推荐){% endif %}</option>{% endfor %}
            </select>
        </div>
        <div class="control-group">
            <label for="paper-language-select">语言:</label>
            <select id="paper-language-select">
                <option value="中文">中文</option>
                <option value="English">English</option>
            </select>
        </div>
        <div class="control-group">
            <label for="paper-temp-slider">Temperature (创意度): <span id="paper-temp-value">1</span></label>
            <input type="range" id="paper-temp-slider" min="0" max="2" step="0.1" value="1">
        </div>
    </div>
</div>


<!-- Idea 部分，独立于论文主体 -->
<div id="idea-container">
    <!-- Idea 卡片将由JavaScript动态生成 -->
</div>

<!-- 论文主体部分 -->
<div id="paper-container" class="paper-document-view">
    <!-- 各个论文部分将由JavaScript动态生成 -->
    <p style="text-align: center; color: var(--text-muted);">正在加载写作工作区...</p>
</div>

<!-- 固定在底部的全局提示词输入栏 -->
<div id="prompt-bar" class="modification-bar" style="display: none;">
    <textarea id="global-prompt-input" placeholder="输入您的修改指令...（Enter 提交, Shift+Enter 换行）"></textarea>
    <button id="submit-prompt-btn" class="btn btn-primary">发送修改</button>
</div>
{% endblock %}